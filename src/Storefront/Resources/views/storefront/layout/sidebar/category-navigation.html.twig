{% block layout_navigation_categories %}
    {% set navigationMaxDepth = context.salesChannel.navigationCategoryDepth %}

    {% if not level %}
        {% set level = 0 %}
    {% endif %}

    {% if feature('cache_rework') %}
        {% set activeId = navigationId %}
        {% set activePath = navigationPath %}
    {% else %}
        {% set activeId = activeResult.id %}
        {% set activePath = activeResult.path %}
    {% endif %}

    {% block layout_navigation_categories_list %}
        <ul class="category-navigation level-{{ level }}">
            {% for item in navigationTree %}
                {% if feature('cache_rework') %}
                    {% set id = item.id %}
                    {% set name = item.name %}
                    {% set category = item %}
                    {% set type = item.type %}
                    {% set children = item.children %}
                {% else %}
                    {% set id = item.category.id %}
                    {% set name = item.category.translated.name %}
                    {% set category = item.category %}
                    {% set type = item.category.type %}
                    {% set children = item.children %}
                {% endif %}

                {% block layout_navigation_categories_list_entry %}

                    <li class="category-navigation-entry">
                        {% if (id in activeId) or (id in activePath) %}
                            {% if type == 'folder' %}
                                {% block layout_navigation_categories_folder_children %}
                                    <span class="category-navigation-link">{{ name }}</span>
                                {% endblock %}
                            {% else %}
                                {% block layout_navigation_categories_link_children %}
                                    <a class="category-navigation-link{% if id is same as(activeId) %} is-active{% endif %}{% if id in activePath %} in-path{% endif %}"
                                        href="{{ category_url(category) }}"
                                        {% if category_linknewtab(category) %}target="_blank"{% endif %}>
                                        {% block layout_navigation_categories_link_children_name %}
                                            {{ name }}
                                        {% endblock %}
                                    </a>
                                {% endblock %}
                            {% endif %}

                            {% block layout_navigation_categories_recoursion %}
                                {% if level < navigationMaxDepth %}
                                    {% sw_include '@Storefront/storefront/layout/sidebar/category-navigation.html.twig' with {
                                        navigationTree: children,
                                        activeResult: activeResult,
                                        level: level + 1
                                    } only %}
                                {% endif %}
                            {% endblock %}
                        {% else %}
                            {% if type == 'folder' %}
                                {% block layout_navigation_categories_text %}
                                    <span class="category-navigation-link">{{ name }}</span>
                                {% endblock %}
                            {% else %}
                                {% block layout_navigation_categories_link %}
                                    <a class="category-navigation-link{% if id is same as(activeId) %} is-active{% endif %}"
                                        href="{{ category_url(category) }}"
                                        {% if category_linknewtab(category) %}target="_blank"{% endif %}>
                                        {% block layout_navigation_categories_link_name %}
                                            {{ name }}
                                        {% endblock %}
                                    </a>
                                {% endblock %}
                            {% endif %}
                        {% endif %}
                    </li>
                {% endblock %}
            {% endfor %}
        </ul>
    {% endblock %}
{% endblock %}
