{% block section_content_block %}

    {% set top = block.marginTop ? block.marginTop : 0 %}
    {% set right = block.marginRight ? block.marginRight : 0 %}
    {% set bottom = block.marginBottom ? block.marginBottom : 0 %}
    {% set left = block.marginLeft ? block.marginLeft : 0 %}

    {% if top or right or bottom or left %}
        {% set padding = top ~ " " ~ right ~ " " ~ bottom ~ " " ~ left %}
    {% endif %}

    {% set blockBgColor = block.backgroundColor %}

    {% set blockClasses = [block.cssClass, 'pos-' ~ block.position, 'cms-block-' ~ block.type] %}

    {% if block.backgroundMedia %}
        {% set blockClasses = ['bg-image']|merge(blockClasses) %}
    {% endif %}

    {% if blockBgColor %}
        {% set blockClasses = ['bg-color']|merge(blockClasses) %}
    {% endif %}

    {% set columns = 3 %}
    {% set isInSidebar = block.sectionPosition == 'sidebar' %}
    {% set sidebarClasses = '' %}

    {% if isInSidebar == true %}
        {% set sidebarClasses = 'has--sidebar' %}
    {% endif %}

    {% set responsivePaddings = {} %}
    {% for size in ['xs', 'sm', 'md', 'lg', 'xl'] %}
        {% for position in ['top', 'left', 'right', 'bottom'] %}
            {% set value = block.marginResponsive[position] %}

            {% if value.enabled and value[size]|length > 0 %}
                {% set responsivePaddings = {
                    (size): { (position): value[size] }|merge(responsivePaddings[size] ?? {})
                }|merge(responsivePaddings) %}
            {% endif %}
        {% endfor %}
    {% endfor %}

    <style>
        {% for size in responsivePaddings|keys %}

        @media (min-width: {{ theme_config('breakpoint.' ~ size) }}px) {
            [data-cms-block-id="{{ block.id }}"] {
                {% for position, value in responsivePaddings[size] %}
                    padding-{{ position }}: {{ value }};
                {% endfor %}
            }
        }

        {% endfor %}
    </style>

    <div class="cms-block {{ blockClasses|join(' ') }}"
         style="{% if blockBgColor %} background-color: {{ blockBgColor }};{% endif %}"
         data-cms-block-id="{{ block.id }}"
    >
        {% block section_content_block_background_image %}
            {% if block.backgroundMedia %}
                {% sw_thumbnails 'cms-block-background' with {
                    media: block.backgroundMedia,
                    attributes: {
                        class: "cms-block-background media-mode--" ~ block.backgroundMediaMode
                    }
                    } %}
            {% endif %}
        {% endblock %}

        {% block section_content_block_container %}
            <div class="cms-block-container"
                 style="{% if padding %}padding: {{ padding }};{% endif %}">

                {% block section_content_block_row %}
                    <div class="cms-block-container-row row cms-row {{ sidebarClasses }}">
                        {% sw_include "@Storefront/storefront/block/cms-block-" ~ block.type ~ ".html.twig" ignore missing %}
                    </div>
                {% endblock %}
            </div>
        {% endblock %}
    </div>
{% endblock %}
